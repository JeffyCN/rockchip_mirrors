From c482fdaa112c6604f14b24127676a8462d5790e0 Mon Sep 17 00:00:00 2001
From: Zain Wang <wzz@rock-chips.com>
Date: Sat, 27 Jan 2024 15:31:53 +0800
Subject: [PATCH] MtpDatabase: Do not modify file name in ROOT directory

Signed-off-by: Zain Wang <wzz@rock-chips.com>
---
 server/UbuntuMtpDatabase.h | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/server/UbuntuMtpDatabase.h b/server/UbuntuMtpDatabase.h
index 29bd315..48720ec 100755
--- a/server/UbuntuMtpDatabase.h
+++ b/server/UbuntuMtpDatabase.h
@@ -675,6 +675,9 @@ public:
             case MTP_PROPERTY_OBJECT_FILE_NAME:
                 try {
                     entry = db.at(handle);
+                    if (entry.parent == 0)
+                        return MTP_RESPONSE_INVALID_OBJECT_HANDLE;
+
 
                     if (!packet.getString(buffer)) {
                         LOG(ERROR) << "Cannot read packet";
-- 
2.34.1

